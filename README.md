# çƒ­æœæ•°æ®é‡‡é›†ç³»ç»Ÿ

ç»¼åˆæ€§çƒ­æœæ•°æ®é‡‡é›†ç³»ç»Ÿï¼Œæ”¯æŒ16ä¸ªä¸­æ–‡å¹³å° + 3ä¸ªå›½é™…å¹³å°çš„å®æ—¶çƒ­ç‚¹æ•°æ®æŠ“å–ï¼Œä¸ºå­¦æœ¯ç ”ç©¶æä¾›é«˜è´¨é‡æ—¶åºæ•°æ®ã€‚

## ğŸ¯ ç ”ç©¶æ–¹å‘

- **æ—¶é—´åºåˆ—é¢„æµ‹**ï¼š30åˆ†é’Ÿç²’åº¦çš„é«˜é¢‘æ—¶åºæ•°æ®
- **ç®—æ³•æ²»ç†**ï¼šå¹³å°æ¨èç®—æ³•è¡Œä¸ºåˆ†æ
- **èˆ†æƒ…åˆ†æ**ï¼šè·¨å¹³å°è¯é¢˜ç”Ÿå‘½å‘¨æœŸè¿½è¸ª
- **è·¨æ–‡åŒ–ç ”ç©¶**ï¼šä¸­å¤–å¹³å°çƒ­ç‚¹å·®å¼‚å¯¹æ¯”

## âœ¨ æ ¸å¿ƒåŠŸèƒ½

### æ•°æ®é‡‡é›†
- âœ… **16ä¸ªä¸­æ–‡å¹³å°**ï¼šå“”å“©å“”å“©ã€å¾®åšã€çŸ¥ä¹ã€æŠ–éŸ³ã€ç™¾åº¦ã€å°‘æ•°æ´¾ã€ITä¹‹å®¶ã€æ¾æ¹ƒæ–°é—»ã€ä»Šæ—¥å¤´æ¡ã€36æ°ªã€ç¨€åœŸæ˜é‡‘ã€è…¾è®¯æ–°é—»ã€ç½‘æ˜“æ–°é—»ã€è‹±é›„è”ç›Ÿã€åŸç¥ã€å¾®ä¿¡è¯»ä¹¦
- âœ… **3ä¸ªå›½é™…å¹³å°**ï¼šTwitterï¼ˆå·²å®ç°ï¼‰ã€Redditï¼ˆå¾…ä¿®å¤ï¼‰ã€YouTubeï¼ˆå¾…ä¿®å¤ï¼‰

### æ•°æ®å­˜å‚¨
- âœ… **SQLiteæ•°æ®åº“**ï¼šæ”¯æŒæ—¶åºæŸ¥è¯¢å’Œæ•°æ®åˆ†æ
  - hotsearch_rawï¼šåŸå§‹æ•°æ®
  - ranking_historyï¼šæ’åå†å²è¿½è¸ªï¼ˆè‡ªåŠ¨è®¡ç®—rank_changeã€hot_changeã€hot_growth_rateï¼‰
  - item_detailsï¼šè¯¦æƒ…æ•°æ®
  - cross_platformï¼šè·¨å¹³å°å…³è”
- âœ… **JSONæ–‡ä»¶**ï¼šå‘åå…¼å®¹ï¼Œä¾¿äºæ•°æ®äº¤æ¢

### è°ƒåº¦ç³»ç»Ÿ
- âœ… **ä¸­æ–‡å¹³å°è°ƒåº¦å™¨**ï¼šæ¯30åˆ†é’Ÿé‡‡é›†1æ¬¡ï¼ˆ48æ¬¡/å¤©ï¼‰
- âœ… **å›½é™…å¹³å°è°ƒåº¦å™¨**ï¼šæ¯å¤©é‡‡é›†1æ¬¡ï¼ˆä¿æŠ¤å…è´¹APIé…é¢ï¼‰
- âœ… **systemdæœåŠ¡é›†æˆ**ï¼šæ”¯æŒUbuntuæœåŠ¡å™¨è‡ªåŠ¨è¿è¡Œ

### æ•°æ®åˆ†æ
- âœ… **æ—¶åºæŸ¥è¯¢**ï¼šæŸ¥è¯¢å•ä¸ªçƒ­æœçš„å†å²å˜åŒ–
- âœ… **è¶‹åŠ¿åˆ†æ**ï¼šæŸ¥è¯¢æŒç»­ä¸Šæ¦œçš„çƒ­ç‚¹è¯é¢˜
- âœ… **çƒ­åº¦è¿½è¸ª**ï¼šæŸ¥è¯¢æœ€å¿«ä¸Šå‡çš„çƒ­æœ
- âœ… **CSVå¯¼å‡º**ï¼šå¯¼å‡ºæ•°æ®ç”¨äºå­¦æœ¯åˆ†æ

## ğŸ“Š æ•°æ®é‡é¢„ä¼°

| æ—¶é—´å‘¨æœŸ | ä¸­æ–‡å¹³å° | å›½é™…å¹³å° | æ€»è®¡ | å­˜å‚¨å®¹é‡ |
|---------|---------|---------|------|---------|
| 1å¤© | 38,400æ¡ | 40æ¡ | 38,440æ¡ | ~32MB |
| 1å‘¨ | 268,800æ¡ | 280æ¡ | 269,080æ¡ | ~224MB |
| 1æœˆ | 1,152,000æ¡ | 1,200æ¡ | 1,153,200æ¡ | ~950MB |
| 3æœˆ | 3,456,000æ¡ | 3,600æ¡ | 3,459,600æ¡ | ~2.8GB |

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
pip3 install -r requirements.txt
```

### 2. æœ¬åœ°æµ‹è¯•

```bash
# æµ‹è¯•ä¸­æ–‡å¹³å°çˆ¬è™«ï¼ˆå•æ¬¡ï¼‰
python3 crawler.py

# æµ‹è¯•å¤–éƒ¨APIï¼ˆå•æ¬¡ï¼‰
python3 external_scheduler.py --once

# æŸ¥çœ‹æ•°æ®åº“æ•°æ®
python3 -c "from database import HotSearchDatabase; db = HotSearchDatabase('data/hotsearch.db'); print(db.get_statistics())"
```

### 3. å¯åŠ¨å®šæ—¶ä»»åŠ¡

```bash
# å¯åŠ¨ä¸­æ–‡å¹³å°è°ƒåº¦å™¨ï¼ˆæ¯30åˆ†é’Ÿï¼‰
python3 scheduler.py --interval 30

# å¯åŠ¨å›½é™…å¹³å°è°ƒåº¦å™¨ï¼ˆæ¯å¤©å‡Œæ™¨2ç‚¹ï¼‰
python3 external_scheduler.py --hour 2
```

## ğŸ–¥ï¸ UbuntuæœåŠ¡å™¨éƒ¨ç½²

### ä¸€é”®éƒ¨ç½²ï¼ˆæ¨èï¼‰

```bash
# 1. å…‹éš†ä»£ç 
git clone git@github.com:yalisha/JuheC.git
cd JuheC

# 2. è¿è¡Œéƒ¨ç½²è„šæœ¬
sudo bash deploy.sh

# 3. å¯åŠ¨æœåŠ¡
sudo systemctl start hotsearch-crawler
sudo systemctl start hotsearch-external

# 4. æŸ¥çœ‹çŠ¶æ€
./manage.sh status
```

### æ‰‹åŠ¨é…ç½®

#### ä¸­æ–‡å¹³å°æœåŠ¡ï¼š`/etc/systemd/system/hotsearch-crawler.service`

```ini
[Unit]
Description=HotSearch Crawler (30min)
After=network.target

[Service]
Type=simple
User=your_username
WorkingDirectory=/path/to/çƒ­ç‚¹çˆ¬å–
ExecStart=/usr/bin/python3 scheduler.py --interval 30
Restart=always
RestartSec=600

[Install]
WantedBy=multi-user.target
```

#### å›½é™…å¹³å°æœåŠ¡ï¼š`/etc/systemd/system/hotsearch-external.service`

```ini
[Unit]
Description=External API Scheduler (Daily)
After=network.target

[Service]
Type=simple
User=your_username
WorkingDirectory=/path/to/çƒ­ç‚¹çˆ¬å–
ExecStart=/usr/bin/python3 external_scheduler.py --hour 2
Restart=always
RestartSec=3600

[Install]
WantedBy=multi-user.target
```

#### å¯åŠ¨æœåŠ¡

```bash
sudo systemctl daemon-reload
sudo systemctl enable hotsearch-crawler hotsearch-external
sudo systemctl start hotsearch-crawler hotsearch-external
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
çƒ­ç‚¹çˆ¬å–/
â”œâ”€â”€ crawler.py              # ä¸­æ–‡å¹³å°çˆ¬è™«
â”œâ”€â”€ scheduler.py            # ä¸­æ–‡å¹³å°è°ƒåº¦å™¨ï¼ˆ30åˆ†é’Ÿï¼‰
â”œâ”€â”€ external_apis.py        # å›½é™…å¹³å°APIå°è£…
â”œâ”€â”€ external_scheduler.py   # å›½é™…å¹³å°è°ƒåº¦å™¨ï¼ˆæ¯å¤©1æ¬¡ï¼‰
â”œâ”€â”€ database.py             # SQLiteæ•°æ®åº“æ¨¡å—
â”œâ”€â”€ config.json             # é…ç½®æ–‡ä»¶
â”œâ”€â”€ requirements.txt        # Pythonä¾èµ–
â”œâ”€â”€ run.sh                  # å¿«é€Ÿå¯åŠ¨è„šæœ¬
â”œâ”€â”€ deploy.sh               # Ubuntuéƒ¨ç½²è„šæœ¬
â”œâ”€â”€ manage.sh               # æœåŠ¡ç®¡ç†è„šæœ¬
â”œâ”€â”€ data/                   # æ•°æ®ç›®å½•
â”‚   â”œâ”€â”€ hotsearch.db        # SQLiteæ•°æ®åº“
â”‚   â”œâ”€â”€ latest.json         # æœ€æ–°ä¸­æ–‡å¹³å°æ•°æ®
â”‚   â”œâ”€â”€ hotsearch_*.json    # å†å²ä¸­æ–‡å¹³å°æ•°æ®
â”‚   â”œâ”€â”€ external_*.json     # å›½é™…å¹³å°æ•°æ®
â”‚   â””â”€â”€ external_api_status.json  # APIè°ƒç”¨çŠ¶æ€
â””â”€â”€ logs/                   # æ—¥å¿—ç›®å½•
    â”œâ”€â”€ crawler_*.log       # ä¸­æ–‡å¹³å°æ—¥å¿—
    â””â”€â”€ external_api.log    # å›½é™…å¹³å°æ—¥å¿—
```

## ğŸ”§ é…ç½®è¯´æ˜

### config.json

```json
{
  "crawler": {
    "data_dir": "data",
    "log_dir": "logs",
    "platforms": ["å“”å“©å“”å“©", "å¾®åš", "çŸ¥ä¹", ...]
  },
  "scheduler": {
    "interval_minutes": 30,    // 30åˆ†é’Ÿé‡‡é›†1æ¬¡
    "run_on_startup": true,
    "save_history": true,
    "use_database": true       // å¯ç”¨SQLiteæ•°æ®åº“
  },
  "request": {
    "timeout": 10,
    "retry": 3,
    "delay_between_requests": 1
  }
}
```

### å¤–éƒ¨APIé…é¢ç®¡ç† âš ï¸

å…è´¹APIæ¯æœˆè°ƒç”¨æ¬¡æ•°é™åˆ¶ï¼š

| APIæœåŠ¡ | æœˆåº¦é…é¢ | æ¯æ—¥ç­–ç•¥ | æœˆåº¦æ¶ˆè€— | ä½™é‡ |
|---------|----------|----------|----------|------|
| Twitter Trends | 100æ¬¡/æœˆ | 1æ¬¡/å¤© | 30æ¬¡/æœˆ | 70æ¬¡ |
| ReddAPI | 50æ¬¡/æœˆ | 1æ¬¡/å¤© | 30æ¬¡/æœˆ | 20æ¬¡ |
| Social Media Master | 70æ¬¡/æœˆ | 1æ¬¡/å¤© | 30æ¬¡/æœˆ | 40æ¬¡ |

**ä¿æŠ¤æœºåˆ¶**ï¼š
- âœ… æ¯å¤©æœ€å¤šè°ƒç”¨1æ¬¡ï¼ˆè‡ªåŠ¨æ£€æµ‹å½“å¤©æ˜¯å¦å·²è°ƒç”¨ï¼‰
- âœ… æœˆåº¦ç»Ÿè®¡å’ŒçŠ¶æ€æŒä¹…åŒ–
- âœ… å®Œæ•´çš„æ—¥å¿—è®°å½•

## ğŸ“Š æ•°æ®åº“æŸ¥è¯¢ç¤ºä¾‹

### Python API

```python
from database import HotSearchDatabase

db = HotSearchDatabase('data/hotsearch.db')

# æŸ¥è¯¢å•ä¸ªçƒ­æœçš„å†å²
history = db.get_item_history('å“”å“©å“”å“©', 'BV1234', hours=24)

# æŸ¥è¯¢æŒç»­ä¸Šæ¦œçš„çƒ­ç‚¹
trending = db.get_trending_topics('å¾®åš', hours=24, min_appearances=5)

# æŸ¥è¯¢æœ€å¿«ä¸Šå‡çš„çƒ­æœ
rising = db.get_fastest_rising('çŸ¥ä¹', limit=10)

# å¯¼å‡ºä¸ºCSV
db.export_to_csv('output.csv', platform='æŠ–éŸ³', start_date='2025-10-01')

# ç»Ÿè®¡ä¿¡æ¯
stats = db.get_statistics()
print(f"æ€»è®°å½•æ•°: {stats['total_records']}")
print(f"æœ€æ–°è®°å½•: {stats['latest_record']}")
```

### SQLæŸ¥è¯¢

```sql
-- æŸ¥è¯¢å“”å“©å“”å“©è¿‡å»24å°æ—¶çš„çƒ­åº¦Top10
SELECT title, MAX(hot) as max_hot, 
       COUNT(*) as appearances,
       MAX(hot) - MIN(hot) as hot_growth
FROM ranking_history
WHERE platform = 'å“”å“©å“”å“©'
  AND collected_at > datetime('now', '-24 hours')
GROUP BY item_id
ORDER BY max_hot DESC
LIMIT 10;

-- æŸ¥è¯¢æ’åä¸Šå‡æœ€å¿«çš„çƒ­æœ
SELECT title, rank_change, hot_change, hot_growth_rate
FROM ranking_history
WHERE rank_change > 0
ORDER BY rank_change DESC
LIMIT 20;
```

## ğŸ› ï¸ æœåŠ¡ç®¡ç†

```bash
./manage.sh status      # æŸ¥çœ‹æœåŠ¡çŠ¶æ€
./manage.sh start       # å¯åŠ¨æœåŠ¡
./manage.sh stop        # åœæ­¢æœåŠ¡
./manage.sh restart     # é‡å¯æœåŠ¡
./manage.sh logs        # æŸ¥çœ‹å®æ—¶æ—¥å¿—
./manage.sh data        # æŸ¥çœ‹æ•°æ®æ‘˜è¦
./manage.sh clean       # æ¸…ç†æ—§æ•°æ®
./manage.sh test        # æµ‹è¯•è¿è¡Œ
./manage.sh uninstall   # å¸è½½æœåŠ¡
```

## ğŸ“– æ–‡æ¡£

- [Phase 1 å‡çº§è¯´æ˜](PHASE1_UPGRADE.md) - æ•°æ®å¢å¼ºåŠŸèƒ½è¯¦è§£
- [Ubuntuéƒ¨ç½²æ–‡æ¡£](DEPLOY_UBUNTU.md) - è¯¦ç»†éƒ¨ç½²è¯´æ˜
- [å¿«é€Ÿéƒ¨ç½²æŒ‡å—](SERVER_QUICKSTART.md) - 3åˆ†é’Ÿå¿«é€Ÿéƒ¨ç½²

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **APIé…é¢ä¿æŠ¤**ï¼šå¤–éƒ¨APIä¸ºå…è´¹å±‚çº§ï¼Œå¿…é¡»ä½¿ç”¨ `external_scheduler.py` é¿å…è¶…å‡ºé…é¢
2. **æ•°æ®æ¸…ç†**ï¼šå»ºè®®å®šæœŸæ¸…ç†3ä¸ªæœˆä»¥å‰çš„JSONå†å²æ–‡ä»¶ï¼ˆæ•°æ®åº“æ•°æ®å¯ä¿ç•™ï¼‰
3. **ç½‘ç»œè¦æ±‚**ï¼šå¤–éƒ¨APIéœ€è¦èƒ½è®¿é—®å›½é™…ç½‘ç»œ
4. **å­˜å‚¨ç©ºé—´**ï¼šå»ºè®®é¢„ç•™è‡³å°‘10GBç©ºé—´ç”¨äºé•¿æœŸæ•°æ®ç§¯ç´¯
5. **åˆè§„ä½¿ç”¨**ï¼šæ•°æ®ä»…ä¾›å­¦æœ¯ç ”ç©¶ä½¿ç”¨ï¼Œè¯·éµå®ˆç›¸å…³APIä½¿ç”¨æ¡æ¬¾

## ğŸ” æ•…éšœæ’æŸ¥

### ä¸­æ–‡å¹³å°æ•°æ®ä¸ºç©º
- æ£€æŸ¥ç½‘ç»œè¿æ¥
- ç¡®è®¤API `https://api.pearktrue.cn/api/dailyhot/` æ˜¯å¦æ­£å¸¸
- æŸ¥çœ‹æ—¥å¿—ï¼š`tail -f logs/crawler_*.log`

### å¤–éƒ¨APIè°ƒç”¨å¤±è´¥
- æ£€æŸ¥RapidAPIå¯†é’¥æ˜¯å¦æœ‰æ•ˆ
- ç¡®è®¤APIé…é¢æ˜¯å¦å·²ç”¨å®Œï¼ˆæŸ¥çœ‹ `data/external_api_status.json`ï¼‰
- æŸ¥çœ‹æ—¥å¿—ï¼š`tail -f logs/external_api.log`

### æ•°æ®åº“æŸ¥è¯¢æ…¢
- æ£€æŸ¥æ˜¯å¦åˆ›å»ºäº†ç´¢å¼•
- è€ƒè™‘æŒ‰æœˆä»½åˆ†è¡¨
- å®šæœŸæ¸…ç†è¿‡æœŸæ•°æ®

## ğŸ“ˆ æ•°æ®ç¤ºä¾‹

### ä¸­æ–‡å¹³å°æ•°æ®ï¼ˆlatest.jsonï¼‰

```json
{
  "crawl_time": "2025-10-23T20:28:25",
  "platforms": {
    "å“”å“©å“”å“©": {
      "platform": "å“”å“©å“”å“©",
      "timestamp": "2025-10-23T20:28:25",
      "data": [
        {
          "id": "BV1234",
          "title": "çƒ­æœæ ‡é¢˜",
          "desc": "çƒ­æœæè¿°",
          "url": "https://...",
          "hot": 6481884,
          "timestamp": 1729684105000
        }
      ]
    }
  }
}
```

### å›½é™…å¹³å°æ•°æ®ï¼ˆexternal_*.jsonï¼‰

```json
{
  "crawl_time": "2025-10-23T20:40:31",
  "platforms": {
    "Twitter": {
      "platform": "Twitter",
      "location": "United States",
      "timestamp": "2025-10-23T20:40:31",
      "data": [
        {
          "id": "Hillary",
          "title": "Hillary",
          "desc": "Rank 3 | Politics",
          "url": "https://twitter.com/search?q=%22Hillary%22",
          "hot": 68400,
          "rank": 3,
          "domain": "Politics"
        }
      ]
    }
  }
}
```

## ğŸ“œ æ›´æ–°æ—¥å¿—

### v1.2.0 (2025-10-23) - Phase 1.1
- âœ¨ æ–°å¢å¤–éƒ¨APIç‹¬ç«‹è°ƒåº¦å™¨
- ğŸ”’ APIé…é¢ä¿æŠ¤æœºåˆ¶
- âœ… Twitter APIæ•°æ®æ ¼å¼ä¿®å¤
- ğŸ“Š æœˆåº¦è°ƒç”¨ç»Ÿè®¡
- ğŸ“– å®Œå–„æ–‡æ¡£å’Œä½¿ç”¨æŒ‡å—

### v1.1.0 (2025-10-23) - Phase 1
- ğŸ—„ï¸ SQLiteæ•°æ®åº“å­˜å‚¨ç³»ç»Ÿ
- âš¡ 30åˆ†é’Ÿé‡‡é›†é¢‘ç‡
- ğŸŒ å¤–éƒ¨APIé›†æˆæ¡†æ¶
- ğŸ“ˆ æ—¶åºæ•°æ®è‡ªåŠ¨è¿½è¸ª
- ğŸ“ å­¦æœ¯ç ”ç©¶æ•°æ®æ”¯æŒ

### v1.0.0 (2025-10-23)
- âœ¨ åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- âœ… æ”¯æŒ16ä¸ªä¸­æ–‡å¹³å°
- â° å®šæ—¶è°ƒåº¦åŠŸèƒ½
- ğŸ’¾ æ•°æ®æŒä¹…åŒ–å­˜å‚¨

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®ä»…ä¾›å­¦æœ¯ç ”ç©¶ä½¿ç”¨ã€‚ä½¿ç”¨æœ¬ç³»ç»Ÿé‡‡é›†çš„æ•°æ®æ—¶ï¼Œè¯·éµå®ˆï¼š
1. ç›¸å…³å¹³å°çš„æœåŠ¡æ¡æ¬¾
2. APIæä¾›æ–¹çš„ä½¿ç”¨é™åˆ¶
3. å­¦æœ¯è¯šä¿¡å’Œæ•°æ®éšç§ä¿æŠ¤åŸåˆ™

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤Issueå’ŒPull Requestï¼

## ğŸ“§ è”ç³»æ–¹å¼

- GitHub: [yalisha/JuheC](https://github.com/yalisha/JuheC)
- Issues: [æäº¤é—®é¢˜](https://github.com/yalisha/JuheC/issues)
